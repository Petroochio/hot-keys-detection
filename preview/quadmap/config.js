// normalized based on image height

// const IMGW = 960;
// const IMGH = 540;

// const IMGW = 1120;
// const IMGH = 630;

const IMGW = 1280;
const IMGH = 720;

// const IMGW = 1920;
// const IMGH = 1080;

// paste calibration data into QUADS_CALIBRATED and CELLS_CALIBRATED
const QUADS_CALIBRATED = [[{"x":0.05546875,"y":0.130555555555556},{"x":0.059375,"y":0.286111111111111},{"x":0.07109375,"y":0.438888888888889},{"x":0.08828125,"y":0.581944444444444},{"x":0.10859375,"y":0.713888888888889},{"x":0.13046875,"y":0.829166666666667},{"x":0.153125,"y":0.927777777777778}],[{"x":0.10546875,"y":0.105555555555556},{"x":0.11015625,"y":0.272222222222222},{"x":0.12109375,"y":0.434722222222222},{"x":0.1375,"y":0.5875},{"x":0.15703125,"y":0.725},{"x":0.178125,"y":0.843055555555556},{"x":0.20078125,"y":0.944444444444444}],[{"x":0.16640625,"y":0.0833333333333333},{"x":0.16953125,"y":0.259722222222222},{"x":0.1796875,"y":0.431944444444444},{"x":0.1953125,"y":0.591666666666667},{"x":0.21328125,"y":0.736111111111111},{"x":0.2328125,"y":0.856944444444444},{"x":0.25234375,"y":0.959722222222222}],[{"x":0.2375,"y":0.0597222222222222},{"x":0.23984375,"y":0.245833333333333},{"x":0.2484375,"y":0.429166666666667},{"x":0.26171875,"y":0.597222222222222},{"x":0.2765625,"y":0.745833333333333},{"x":0.29375,"y":0.869444444444444},{"x":0.31015625,"y":0.972222222222222}],[{"x":0.31953125,"y":0.0416666666666667},{"x":0.3203125,"y":0.236111111111111},{"x":0.32734375,"y":0.426388888888889},{"x":0.33671875,"y":0.6},{"x":0.34765625,"y":0.751388888888889},{"x":0.36015625,"y":0.877777777777778},{"x":0.371875,"y":0.981944444444444}],[{"x":0.41015625,"y":0.0319444444444444},{"x":0.41015625,"y":0.230555555555556},{"x":0.4125,"y":0.425},{"x":0.41796875,"y":0.604166666666667},{"x":0.4234375,"y":0.756944444444444},{"x":0.43046875,"y":0.884722222222222},{"x":0.43671875,"y":0.988888888888889}],[{"x":0.50546875,"y":0.0277777777777778},{"x":0.50390625,"y":0.229166666666667},{"x":0.50390625,"y":0.425},{"x":0.503125,"y":0.604166666666667},{"x":0.50390625,"y":0.758333333333333},{"x":0.503125,"y":0.886111111111111},{"x":0.50390625,"y":0.990277777777778}],[{"x":0.6015625,"y":0.0333333333333333},{"x":0.5984375,"y":0.231944444444444},{"x":0.59375,"y":0.426388888888889},{"x":0.5890625,"y":0.604166666666667},{"x":0.5828125,"y":0.758333333333333},{"x":0.5765625,"y":0.884722222222222},{"x":0.57109375,"y":0.988888888888889}],[{"x":0.6921875,"y":0.0472222222222222},{"x":0.68828125,"y":0.240277777777778},{"x":0.68046875,"y":0.429166666666667},{"x":0.6703125,"y":0.602777777777778},{"x":0.659375,"y":0.752777777777778},{"x":0.64765625,"y":0.879166666666667},{"x":0.6359375,"y":0.981944444444444}],[{"x":0.7734375,"y":0.0666666666666667},{"x":0.76953125,"y":0.251388888888889},{"x":0.759375,"y":0.433333333333333},{"x":0.74609375,"y":0.601388888888889},{"x":0.73046875,"y":0.747222222222222},{"x":0.7140625,"y":0.869444444444444},{"x":0.69765625,"y":0.973611111111111}],[{"x":0.8453125,"y":0.0888888888888889},{"x":0.83984375,"y":0.263888888888889},{"x":0.82890625,"y":0.436111111111111},{"x":0.81328125,"y":0.595833333333333},{"x":0.7953125,"y":0.7375},{"x":0.775,"y":0.859722222222222},{"x":0.75625,"y":0.961111111111111}],[{"x":0.90625,"y":0.1125},{"x":0.90078125,"y":0.277777777777778},{"x":0.88828125,"y":0.440277777777778},{"x":0.871875,"y":0.591666666666667},{"x":0.8515625,"y":0.726388888888889},{"x":0.83046875,"y":0.844444444444444},{"x":0.80859375,"y":0.945833333333333}],[{"x":0.9572639479524473,"y":0.13730255164034022},{"x":0.95078125,"y":0.291666666666667},{"x":0.9390625,"y":0.444444444444444},{"x":0.921875,"y":0.586111111111111},{"x":0.9015625,"y":0.715277777777778},{"x":0.87890625,"y":0.830555555555556},{"x":0.85625,"y":0.929166666666667}]];
const CELLS_CALIBRATED = [[{"x":31, "y":698},{"x":31, "y":588},{"x":31, "y":478},{"x":31, "y":368},{"x":31, "y":258},{"x":31, "y":148},{"x":31, "y":38}],[{"x":121, "y":698},{"x":121, "y":588},{"x":121, "y":478},{"x":121, "y":368},{"x":121, "y":258},{"x":121, "y":148},{"x":121, "y":38}],[{"x":211, "y":698},{"x":211, "y":588},{"x":211, "y":478},{"x":211, "y":368},{"x":211, "y":258},{"x":211, "y":148},{"x":211, "y":38}],[{"x":301, "y":698},{"x":301, "y":588},{"x":301, "y":478},{"x":301, "y":368},{"x":301, "y":258},{"x":301, "y":148},{"x":301, "y":38}],[{"x":391, "y":698},{"x":391, "y":588},{"x":391, "y":478},{"x":391, "y":368},{"x":391, "y":258},{"x":391, "y":148},{"x":391, "y":38}],[{"x":481, "y":698},{"x":481, "y":588},{"x":481, "y":478},{"x":481, "y":368},{"x":481, "y":258},{"x":481, "y":148},{"x":481, "y":38}],[{"x":571, "y":698},{"x":571, "y":588},{"x":571, "y":478},{"x":571, "y":368},{"x":571, "y":258},{"x":571, "y":148},{"x":571, "y":38}],[{"x":661, "y":698},{"x":661, "y":588},{"x":661, "y":478},{"x":661, "y":368},{"x":661, "y":258},{"x":661, "y":148},{"x":661, "y":38}],[{"x":751, "y":698},{"x":751, "y":588},{"x":751, "y":478},{"x":751, "y":368},{"x":751, "y":258},{"x":751, "y":148},{"x":751, "y":38}],[{"x":841, "y":698},{"x":841, "y":588},{"x":841, "y":478},{"x":841, "y":368},{"x":841, "y":258},{"x":841, "y":148},{"x":841, "y":38}],[{"x":931, "y":698},{"x":931, "y":588},{"x":931, "y":478},{"x":931, "y":368},{"x":931, "y":258},{"x":931, "y":148},{"x":931, "y":38}],[{"x":1021, "y":698},{"x":1021, "y":588},{"x":1021, "y":478},{"x":1021, "y":368},{"x":1021, "y":258},{"x":1021, "y":148},{"x":1021, "y":38}],[{"x":1111, "y":698},{"x":1111, "y":588},{"x":1111, "y":478},{"x":1111, "y":368},{"x":1111, "y":258},{"x":1111, "y":148},{"x":1111, "y":38}]];

const QUADSNORM = generateQuads(QUADS_CALIBRATED);

const QUADS = QUADSNORM.map(
  subset => subset.map(
    q => ({
      x: q.x * IMGW,
      y: q.y * IMGH,
    })
  )
);

const CELLS = generateQuads(CELLS_CALIBRATED);

const CELLS_SIMPLE = CELLS.map(c => ({
  corner: c[0],
  w: c[2].x - c[0].x,
  h: c[2].y - c[0].y,
}));




function generateQuads(q) {
  var a0 = shiftArray2D(q, -1, -1);
  var a1 = shiftArray2D(q, 1, -1);
  var a2 = shiftArray2D(q, 1, 1);
  var a3 = shiftArray2D(q, -1, 1);
  var quadArr = [];
  for (var i=0; i<a0.length; i++) {
    for (var j=0; j<a0[i].length; j++) {
      var temparr = [];
      temparr.push(a0[i][j]);
      temparr.push(a1[i][j]);
      temparr.push(a2[i][j]);
      temparr.push(a3[i][j]);
      quadArr.push(temparr);
    }
  }
  return quadArr;
}

function shiftArray(arr, index) {
  var newarr = [];
  if (index > 0) {
    for (var i=index; i<arr.length; i++) {
      newarr.push(arr[i]);
    }
  } else if (index < 0) {
    for (var i=0; i<arr.length+index; i++) {
      newarr.push(arr[i]);
    }
  }
  return newarr;
}

function shiftArray2D(arr, index1, index2) {
  var newarr = arr.map( a => shiftArray(a, index2));
  newarr = shiftArray(newarr, index1);
  return newarr;
}


// const QUADSNORM = [
//   [{x:71, y:94},{x:135, y:76},{x:141, y:196},{x:76, y:206}],
//   [{x:135, y:76},{x:213, y:60},{x:217, y:187},{x:141, y:196}],
//   [{x:213, y:60},{x:304, y:43},{x:307, y:177},{x:217, y:187}],
//   [{x:304, y:43},{x:409, y:30},{x:410, y:170},{x:307, y:177}],
//   [{x:409, y:30},{x:525, y:23},{x:525, y:166},{x:410, y:170}],
//   [{x:525, y:23},{x:647, y:20},{x:645, y:165},{x:525, y:166}],
//   [{x:647, y:20},{x:770, y:24},{x:766, y:167},{x:645, y:165}],
//   [{x:770, y:24},{x:886, y:34},{x:881, y:173},{x:766, y:167}],
//   [{x:886, y:34},{x:990, y:48},{x:985, y:181},{x:881, y:173}],
//   [{x:990, y:48},{x:1082, y:64},{x:1075, y:190},{x:985, y:181}],
//   [{x:1082, y:64},{x:1160, y:81},{x:1153, y:200},{x:1075, y:190}],
//   [{x:76, y:206},{x:141, y:196},{x:155, y:313},{x:91, y:316}],
//   [{x:141, y:196},{x:217, y:187},{x:230, y:311},{x:155, y:313}],
//   [{x:217, y:187},{x:307, y:177},{x:318, y:309},{x:230, y:311}],
//   [{x:307, y:177},{x:410, y:170},{x:419, y:307},{x:318, y:309}],
//   [{x:410, y:170},{x:525, y:166},{x:528, y:306},{x:419, y:307}],
//   [{x:525, y:166},{x:645, y:165},{x:645, y:306},{x:528, y:306}],
//   [{x:645, y:165},{x:766, y:167},{x:760, y:307},{x:645, y:306}],
//   [{x:766, y:167},{x:881, y:173},{x:871, y:309},{x:760, y:307}],
//   [{x:881, y:173},{x:985, y:181},{x:972, y:312},{x:871, y:309}],
//   [{x:985, y:181},{x:1075, y:190},{x:1061, y:314},{x:972, y:312}],
//   [{x:1075, y:190},{x:1153, y:200},{x:1137, y:317},{x:1061, y:314}],
//   [{x:91, y:316},{x:155, y:313},{x:176, y:423},{x:113, y:419}],
//   [{x:155, y:313},{x:230, y:311},{x:250, y:426},{x:176, y:423}],
//   [{x:230, y:311},{x:318, y:309},{x:335, y:430},{x:250, y:426}],
//   [{x:318, y:309},{x:419, y:307},{x:431, y:432},{x:335, y:430}],
//   [{x:419, y:307},{x:528, y:306},{x:535, y:435},{x:431, y:432}],
//   [{x:528, y:306},{x:645, y:306},{x:644, y:435},{x:535, y:435}],
//   [{x:645, y:306},{x:760, y:307},{x:754, y:435},{x:644, y:435}],
//   [{x:760, y:307},{x:871, y:309},{x:858, y:434},{x:754, y:435}],
//   [{x:871, y:309},{x:972, y:312},{x:955, y:433},{x:858, y:434}],
//   [{x:972, y:312},{x:1061, y:314},{x:1041, y:429},{x:955, y:433}],
//   [{x:1061, y:314},{x:1137, y:317},{x:1116, y:426},{x:1041, y:429}],
//   [{x:113, y:419},{x:176, y:423},{x:201, y:522},{x:139, y:514}],
//   [{x:176, y:423},{x:250, y:426},{x:273, y:530},{x:201, y:522}],
//   [{x:250, y:426},{x:335, y:430},{x:354, y:537},{x:273, y:530}],
//   [{x:335, y:430},{x:431, y:432},{x:445, y:541},{x:354, y:537}],
//   [{x:431, y:432},{x:535, y:435},{x:542, y:545},{x:445, y:541}],
//   [{x:535, y:435},{x:644, y:435},{x:645, y:546},{x:542, y:545}],
//   [{x:644, y:435},{x:754, y:435},{x:746, y:546},{x:645, y:546}],
//   [{x:754, y:435},{x:858, y:434},{x:844, y:542},{x:746, y:546}],
//   [{x:858, y:434},{x:955, y:433},{x:935, y:538},{x:844, y:542}],
//   [{x:955, y:433},{x:1041, y:429},{x:1018, y:531},{x:935, y:538}],
//   [{x:1041, y:429},{x:1116, y:426},{x:1090, y:523},{x:1018, y:531}],
//   [{x:139, y:514},{x:201, y:522},{x:228, y:607},{x:167, y:597}],
//   [{x:201, y:522},{x:273, y:530},{x:298, y:617},{x:228, y:607}],
//   [{x:273, y:530},{x:354, y:537},{x:376, y:626},{x:298, y:617}],
//   [{x:354, y:537},{x:445, y:541},{x:461, y:632},{x:376, y:626}],
//   [{x:445, y:541},{x:542, y:545},{x:551, y:637},{x:461, y:632}],
//   [{x:542, y:545},{x:645, y:546},{x:644, y:638},{x:551, y:637}],
//   [{x:645, y:546},{x:746, y:546},{x:738, y:637},{x:644, y:638}],
//   [{x:746, y:546},{x:844, y:542},{x:829, y:633},{x:738, y:637}],
//   [{x:844, y:542},{x:935, y:538},{x:914, y:626},{x:829, y:633}],
//   [{x:935, y:538},{x:1018, y:531},{x:992, y:619},{x:914, y:626}],
//   [{x:1018, y:531},{x:1090, y:523},{x:1063, y:608},{x:992, y:619}],
//   [{x:167, y:597},{x:228, y:607},{x:257, y:680},{x:196, y:668}],
//   [{x:228, y:607},{x:298, y:617},{x:323, y:691},{x:257, y:680}],
//   [{x:298, y:617},{x:376, y:626},{x:397, y:700},{x:323, y:691}],
//   [{x:376, y:626},{x:461, y:632},{x:476, y:707},{x:397, y:700}],
//   [{x:461, y:632},{x:551, y:637},{x:559, y:712},{x:476, y:707}],
//   [{x:551, y:637},{x:644, y:638},{x:645, y:713},{x:559, y:712}],
//   [{x:644, y:638},{x:738, y:637},{x:731, y:712},{x:645, y:713}],
//   [{x:738, y:637},{x:829, y:633},{x:814, y:707},{x:731, y:712}],
//   [{x:829, y:633},{x:914, y:626},{x:893, y:701},{x:814, y:707}],
//   [{x:914, y:626},{x:992, y:619},{x:968, y:692},{x:893, y:701}],
//   [{x:992, y:619},{x:1063, y:608},{x:1035, y:681},{x:968, y:692}],
// ];

// const CELLS = [
//   [{x:31, y:698},{x:121, y:698},{x:121, y:588},{x:31, y:588}],
//   [{x:121, y:698},{x:211, y:698},{x:211, y:588},{x:121, y:588}],
//   [{x:211, y:698},{x:301, y:698},{x:301, y:588},{x:211, y:588}],
//   [{x:301, y:698},{x:391, y:698},{x:391, y:588},{x:301, y:588}],
//   [{x:391, y:698},{x:481, y:698},{x:481, y:588},{x:391, y:588}],
//   [{x:481, y:698},{x:571, y:698},{x:571, y:588},{x:481, y:588}],
//   [{x:571, y:698},{x:661, y:698},{x:661, y:588},{x:571, y:588}],
//   [{x:661, y:698},{x:751, y:698},{x:751, y:588},{x:661, y:588}],
//   [{x:751, y:698},{x:841, y:698},{x:841, y:588},{x:751, y:588}],
//   [{x:841, y:698},{x:931, y:698},{x:931, y:588},{x:841, y:588}],
//   [{x:931, y:698},{x:1021, y:698},{x:1021, y:588},{x:931, y:588}],
//   [{x:31, y:588},{x:121, y:588},{x:121, y:478},{x:31, y:478}],
//   [{x:121, y:588},{x:211, y:588},{x:211, y:478},{x:121, y:478}],
//   [{x:211, y:588},{x:301, y:588},{x:301, y:478},{x:211, y:478}],
//   [{x:301, y:588},{x:391, y:588},{x:391, y:478},{x:301, y:478}],
//   [{x:391, y:588},{x:481, y:588},{x:481, y:478},{x:391, y:478}],
//   [{x:481, y:588},{x:571, y:588},{x:571, y:478},{x:481, y:478}],
//   [{x:571, y:588},{x:661, y:588},{x:661, y:478},{x:571, y:478}],
//   [{x:661, y:588},{x:751, y:588},{x:751, y:478},{x:661, y:478}],
//   [{x:751, y:588},{x:841, y:588},{x:841, y:478},{x:751, y:478}],
//   [{x:841, y:588},{x:931, y:588},{x:931, y:478},{x:841, y:478}],
//   [{x:931, y:588},{x:1021, y:588},{x:1021, y:478},{x:931, y:478}],
//   [{x:31, y:478},{x:121, y:478},{x:121, y:368},{x:31, y:368}],
//   [{x:121, y:478},{x:211, y:478},{x:211, y:368},{x:121, y:368}],
//   [{x:211, y:478},{x:301, y:478},{x:301, y:368},{x:211, y:368}],
//   [{x:301, y:478},{x:391, y:478},{x:391, y:368},{x:301, y:368}],
//   [{x:391, y:478},{x:481, y:478},{x:481, y:368},{x:391, y:368}],
//   [{x:481, y:478},{x:571, y:478},{x:571, y:368},{x:481, y:368}],
//   [{x:571, y:478},{x:661, y:478},{x:661, y:368},{x:571, y:368}],
//   [{x:661, y:478},{x:751, y:478},{x:751, y:368},{x:661, y:368}],
//   [{x:751, y:478},{x:841, y:478},{x:841, y:368},{x:751, y:368}],
//   [{x:841, y:478},{x:931, y:478},{x:931, y:368},{x:841, y:368}],
//   [{x:931, y:478},{x:1021, y:478},{x:1021, y:368},{x:931, y:368}],
//   [{x:31, y:368},{x:121, y:368},{x:121, y:258},{x:31, y:258}],
//   [{x:121, y:368},{x:211, y:368},{x:211, y:258},{x:121, y:258}],
//   [{x:211, y:368},{x:301, y:368},{x:301, y:258},{x:211, y:258}],
//   [{x:301, y:368},{x:391, y:368},{x:391, y:258},{x:301, y:258}],
//   [{x:391, y:368},{x:481, y:368},{x:481, y:258},{x:391, y:258}],
//   [{x:481, y:368},{x:571, y:368},{x:571, y:258},{x:481, y:258}],
//   [{x:571, y:368},{x:661, y:368},{x:661, y:258},{x:571, y:258}],
//   [{x:661, y:368},{x:751, y:368},{x:751, y:258},{x:661, y:258}],
//   [{x:751, y:368},{x:841, y:368},{x:841, y:258},{x:751, y:258}],
//   [{x:841, y:368},{x:931, y:368},{x:931, y:258},{x:841, y:258}],
//   [{x:931, y:368},{x:1021, y:368},{x:1021, y:258},{x:931, y:258}],
//   [{x:31, y:258},{x:121, y:258},{x:121, y:148},{x:31, y:148}],
//   [{x:121, y:258},{x:211, y:258},{x:211, y:148},{x:121, y:148}],
//   [{x:211, y:258},{x:301, y:258},{x:301, y:148},{x:211, y:148}],
//   [{x:301, y:258},{x:391, y:258},{x:391, y:148},{x:301, y:148}],
//   [{x:391, y:258},{x:481, y:258},{x:481, y:148},{x:391, y:148}],
//   [{x:481, y:258},{x:571, y:258},{x:571, y:148},{x:481, y:148}],
//   [{x:571, y:258},{x:661, y:258},{x:661, y:148},{x:571, y:148}],
//   [{x:661, y:258},{x:751, y:258},{x:751, y:148},{x:661, y:148}],
//   [{x:751, y:258},{x:841, y:258},{x:841, y:148},{x:751, y:148}],
//   [{x:841, y:258},{x:931, y:258},{x:931, y:148},{x:841, y:148}],
//   [{x:931, y:258},{x:1021, y:258},{x:1021, y:148},{x:931, y:148}],
//   [{x:31, y:148},{x:121, y:148},{x:121, y:38},{x:31, y:38}],
//   [{x:121, y:148},{x:211, y:148},{x:211, y:38},{x:121, y:38}],
//   [{x:211, y:148},{x:301, y:148},{x:301, y:38},{x:211, y:38}],
//   [{x:301, y:148},{x:391, y:148},{x:391, y:38},{x:301, y:38}],
//   [{x:391, y:148},{x:481, y:148},{x:481, y:38},{x:391, y:38}],
//   [{x:481, y:148},{x:571, y:148},{x:571, y:38},{x:481, y:38}],
//   [{x:571, y:148},{x:661, y:148},{x:661, y:38},{x:571, y:38}],
//   [{x:661, y:148},{x:751, y:148},{x:751, y:38},{x:661, y:38}],
//   [{x:751, y:148},{x:841, y:148},{x:841, y:38},{x:751, y:38}],
//   [{x:841, y:148},{x:931, y:148},{x:931, y:38},{x:841, y:38}],
//   [{x:931, y:148},{x:1021, y:148},{x:1021, y:38},{x:931, y:38}],
// ];
